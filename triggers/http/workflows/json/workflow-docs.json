{
	"name": "Workflow Docs Generator",
	"description": "This workflow generates documentation for a given workflow in HTML format.",
	"version": "1.0.0",
	"trigger": {
		"http": {
			"method": "*",
			"path": "/:function?",
			"accept": "application/json"
		}
	},
	"steps": [
		{
			"name": "filter-request",
			"node": "@nanoservice-ts/if-else",
			"type": "module"
		}
	],
	"nodes": {
		"filter-request": {
			"conditions": [
				{
					"type": "if",
					"steps": [
						{
							"name": "workflow-ui",
							"node": "workflow-ui",
							"type": "module"
						}
					],
					"condition": "ctx.request.method.toLowerCase() === \"get\" && ctx.request.params.function === undefined"
				},
				{
					"type": "if",
					"steps": [
						{
							"name": "get-workflows",
							"node": "directory-manager",
							"type": "module"
						}
					],
					"condition": "ctx.request.method.toLowerCase() === \"get\" && ctx.request.params.function === \"workflows\""
				},
				{
					"type": "if",
					"steps": [
						{
							"name": "get-workflow-content",
							"node": "file-manager",
							"type": "module"
						},
						{
							"name": "generate-docs",
							"node": "openai",
							"type": "module"
						}
					],
					"condition": "ctx.request.method.toLowerCase() === \"get\" && ctx.request.params.function === \"workflow-doc\""
				},
				{
					"type": "else",
					"steps": [
						{
							"name": "method-not-allowed",
							"node": "error",
							"type": "module"
						}
					]
				}
			]
		},
		"workflow-ui": {
			"inputs": {}
		},
		"get-workflows": {
			"inputs": {
				"path": "js/process.env.WORKFLOWS_PATH + '/json'"
			}
		},
		"method-not-allowed": {
			"inputs": {
				"message": "Method not allowed"
			}
		},
		"get-workflow-content": {
			"inputs": {
				"path": "${ctx.request.query.path}"
			}
		},
		"generate-docs": {
			"inputs": {
				"cache_key": "${ctx.request.query.path}",
				"system": [
					"You are a great technical content creator from Wikipedia",
					"You know how to simplify complex technical concepts",
					"You always extend the description adding more value to the content"
				],
				"prompt": [
					"I want to generate a web page to document our nanoservice workflow in HTML format.",
					"The documentation must include the following sections: title, short description, extended description, steps and nodes.",
					"The title must be bold and the short description must be in italic.",
					"The extended description must be in a paragraph format and must provides a human-readable description of the workflow.",
					"The steps and nodes must be in a list in YAML format.",
					"be careful with the format of the output because the returned content must be a valid HTML file.",
					"so be careful adding any extra information without being a valid HTML format.",
					"Don't include ```html or ```, also anything that is not a valid HTML",
					"Example \n must be replaced with <br/>.",
					"The workflow is in JSON format and this is the content: ${ctx.response.data.content}."
				]
			}
		}
	}
}
